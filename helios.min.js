;(function(f,g){'use strict';var h=typeof exports=='object'&&exports&&(typeof global=='object'&&global&&global==global.global&&(f=global),exports);var toString=Object.prototype.toString,ArrayProto=Array.prototype,push=ArrayProto.push,pop=ArrayProto.pop,slice=ArrayProto.slice,shift=ArrayProto.shift,indexOf=ArrayProto.indexOf,concat=ArrayProto.concat,env,graphUtils={},fn={},comparable={},utils={},graph={'vertices':{},'edges':{},'v_idx':{},'e_idx':{}},unpipedFuncs=['label','id','value','stringify','count','map','clone','path','fork','pin'];Function.prototype.pipe=function(){var b=this;return function(){var a=[],isStep=!fn.include(['as','back','loop','countBy','groupBy','groupSum','store'],b.name);this.traversedVertices={};this.traversedEdges={};push.call(a,this.pipedObjects);push.apply(a,arguments);if(isStep){this.pipeline.steps[this.pipeline.steps.currentStep+=1]={'pipedInArgs':a,'func':b,'pipedOutArgs':[]}}this.pipedObjects=b.apply(this,a);if(isStep&&this.pipeline.steps.currentStep!==0){push.call(this.pipeline.steps[this.pipeline.steps.currentStep].pipedOutArgs,this.pipedObjects)}return this}};function pipe(){var a,self=this;for(a in self){if(typeof self[a]==="function"&&!fn.include(unpipedFuncs,a)){self[a]=self[a].pipe()}}return self}function Helios(){this.traversedVertices={};this.traversedEdges={};this.pipeline={};this.pipedObjects=[];this.preserveSteps=false;utils.resetPipe.call(this);return pipe.call(this)}Helios.toString=function(){return"Helios"};Helios.VERSION='0.0.1';Helios.ENV={'id':'_id','label':'_label','type':'_type','outEid':'_outE','inEid':'_inE','outVid':'_outV','inVid':'_inV'};Helios.newGraph=function(a,b){var c=false,fileExt,key;if(utils.isString(a)){fileExt=a.split('.').pop();c=fileExt.toLowerCase()==='json'}if(!!a&&(a.hasOwnProperty('vertices')||a.hasOwnProperty('edges'))){c=true}if((!!a&&!utils.isString(a)&&!c)||!!b){if(!b){b=a;a=false}for(key in b){if(b.hasOwnProperty(key)){Helios.ENV[key]=b[key]}}}if(!!a&&c){graphUtils.loadGraphSON(a)}if(!!a&&!c){graphUtils.loadGraphML(a)}return new Helios()};graphUtils.loadGraphSON=function(a){var b;env=Helios.ENV;if(utils.isUndefined(a)){return}if(utils.isString(a)){b=new XMLHttpRequest();b.onreadystatechange=function(){if(b.readyState===4){a=JSON.parse(b.response)}};b.open("GET",a,false);b.send(null)}if(a.vertices){graphUtils.loadVertices(a.vertices)}if(a.edges){graphUtils.loadEdges(a.edges)}return Helios};graphUtils.loadVertices=function(a){var i,l,rows=[],vertex={},hasVIndex=!utils.isEmpty(graph.v_idx);if(utils.isArray(a)){rows=a}else{rows.push(a)}l=rows.length;for(i=0;i<l;i+=1){graph.vertices[rows[i][env.id]]={'obj':rows[i],'type':'vertex','outE':{},'inE':{}};vertex=graph.vertices[rows[i][env.id]];if(hasVIndex){utils.addVIndex(vertex)}}}graphUtils.loadEdges=function(a){var i,l,rows=[],edge={},hasEIndex=!utils.isEmpty(graph.e_idx);if(utils.isArray(a)){rows=a}else{rows.push(a)}l=rows.length;for(i=0;i<l;i+=1){edge={'obj':rows[i],'type':'edge','outV':{},'inV':{}};graph.edges[edge.obj[env.id]]=edge;utils.associateVertices(edge);if(hasEIndex){utils.addEIndex(edge)}}}graphUtils.loadGraphML=function(a){var i,j,l,propLen,xmlV=[],xmlE=[],vertex={},edge={},fileExt,xmlhttp,parser,xmlDoc,properties,tempObj={},hasVIndex=!utils.isEmpty(graph.v_idx),hasEIndex=!utils.isEmpty(graph.e_idx);env=Helios.ENV;if(utils.isUndefined(a)){return}if(utils.isString(a)){fileExt=a.split('.').pop();if(fileExt.toLowerCase()==='xml'){xmlhttp=new XMLHttpRequest();xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState===4){xmlDoc=xmlhttp.responseXML}};xmlhttp.open("GET",a,false);xmlhttp.send(null)}else{if(f.DOMParser){parser=new DOMParser();xmlDoc=parser.parseFromString(a,"text/xml")}else{xmlDoc=new ActiveXObject("Microsoft.XMLDOM");xmlDoc.async=false;xmlDoc.loadXML(a)}}}xmlV=xmlDoc.getElementsByTagName("node");xmlE=xmlDoc.getElementsByTagName("edge");if(!!xmlV.length){l=xmlV.length;for(i=0;i<l;i+=1){properties=xmlV[i].getElementsByTagName("data");tempObj={};propLen=properties.length;for(j=0;j<propLen;j+=1){tempObj[properties[j].getAttribute("key")]=properties[j].firstChild.nodeValue}tempObj[env.id]=xmlV[i].getAttribute("id");tempObj[env.type]='vertex';graph.vertices[xmlV[i].getAttribute("id")]={'obj':tempObj,'type':'vertex','outE':{},'inE':{}};vertex=graph.vertices[xmlV[i].getAttribute("id")];if(hasVIndex){utils.addVIndex(vertex)}}}if(!!xmlE.length){l=xmlE.length;for(i=0;i<l;i+=1){properties=xmlE[i].getElementsByTagName("data");tempObj={};propLen=properties.length;for(j=0;j<propLen;j+=1){tempObj[properties[j].getAttribute("key")]=properties[j].firstChild.nodeValue}tempObj[env.id]=xmlE[i].getAttribute("id");tempObj[env.type]='edge';tempObj[env.label]=xmlE[i].getAttribute("label");tempObj[env.outVid]=xmlE[i].getAttribute("source");tempObj[env.inVid]=xmlE[i].getAttribute("target");graph.edges[xmlE[i].getAttribute("id")]={'obj':tempObj,'type':'edge','outV':{},'inV':{}};edge=graph.edges[xmlE[i].getAttribute("id")];utils.associateVertices(edge);if(hasEIndex){utils.addEIndex(edge)}}}return Helios};graphUtils.createVIndex=function(b){var c=[];if(!graph.v_idx[b]){c=utils.toArray(graph.vertices);graph.v_idx[b]={};fn.each(c,function(a){utils.addVIndex(a,b)})}};graphUtils.deleteVIndex=function(a){delete graph.v_idx[a]};graphUtils.createEIndex=function(b){var c=[];if(!graph.e_idx[b]){c=utils.toArray(graph.edges);graph.e_idx[b]={};fn.each(c,function(a){utils.addEIndex(a,b)})}};graphUtils.deleteEIndex=function(a){delete graph.e_idx[a]};utils.addVIndex=function(a,b){var c;if(b){if(!!a.obj[b]){if(!graph.v_idx[b][a.obj[b]]){graph.v_idx[b][a.obj[b]]={}}graph.v_idx[b][a.obj[b]][a.obj[env.id]]=a}}else{for(c in graph.v_idx){if(graph.v_idx.hasOwnProperty(c)){if(!!a.obj[c]){if(!graph.v_idx[c][a.obj[c]]){graph.v_idx[c][a.obj[c]]={}}graph.v_idx[c][a.obj[c]][a.obj[env.id]]=a}}}}};utils.addEIndex=function(a,b){var c;if(b){if(!!a.obj[b]){if(!graph.e_idx[b][a.obj[b]]){graph.e_idx[b][a.obj[b]]={}}graph.e_idx[b][a.obj[b]][a.obj[env.id]]=a}}else{for(c in graph.e_idx){if(graph.e_idx.hasOwnProperty(c)){if(!!a.obj[c]){if(!graph.e_idx[c][a.obj[c]]){graph.e_idx[c][a.obj[c]]={}}graph.e_idx[c][a.obj[c]][a.obj[env.id]]=a}}}}};utils.associateVertices=function(a){var b;if(!graph.vertices[a.obj[env.outVid]]){graph.vertices[a.obj[env.outVid]]={'obj':{},'type':'vertex','outE':{},'inE':{}}}b=graph.vertices[a.obj[env.outVid]];if(!b.outE[a.obj[env.label]]){b.outE[a.obj[env.label]]=[]}a.outV=b;push.call(b.outE[a.obj[env.label]],a);if(!graph.vertices[a.obj[env.inVid]]){graph.vertices[a.obj[env.inVid]]={'obj':{},'type':'vertex','outE':{},'inE':{}}}b=graph.vertices[a.obj[env.inVid]];if(!b.inE[a.obj[env.label]]){b.inE[a.obj[env.label]]=[]}b=graph.vertices[a.obj[env.inVid]];a.inV=b;push.call(b.inE[a.obj[env.label]],a)};graphUtils.close=function(){graph={'vertices':{},'edges':{},'v_idx':{},'e_idx':{}};return Helios};utils.resetPipe=function(){if(!this.preserveSteps){this.pipeline={'steps':{'currentStep':0},'namedStep':{}}}if(!utils.isEmpty(this.pipelineCache)){this.pipeline.steps['1']={};this.pipeline.steps['1'].pipedInArgs=[];this.pipeline.steps['1'].func=this.pipelineCache.func;this.pipeline.steps['1'].pipedOutArgs=this.pipelineCache.pipedOutArgs;this.pipeline.steps.currentStep=1;this.pipedObjects=this.pipelineCache.pipedOutArgs[0]}};utils.toArray=function(o){var k,r=[];for(k in o){if(o.hasOwnProperty(k)){r.push(o[k])}}return r};utils.isArray=function(o){return toString.call(o)==='[object Array]'};utils.isString=function(o){return toString.call(o)==='[object String]'};utils.isNumber=function(o){return toString.call(o)==='[object Number]'};utils.isDate=function(o){return toString.call(o)==='[object Date]'};utils.isEmpty=function(o){var a;if(!o){return true}for(a in o){if(o.hasOwnProperty(a)){return!o[a]}}return true};utils.isFunction=function(o){return toString.call(o)==='[object Function]'};utils.isNull=function(o){return toString.call(o)==='[object Null]'};utils.isUndefined=function(o){return toString.call(o)==='[object Undefined]'};fn.intersection=function(a,b,c){var r=[],o={},i,comp;for(i=0;i<b.length;i+=1){if(!!c){o[b[i].obj[env.id]]=true}else{o[b[i]]=true}}for(i=0;i<a.length;i+=1){comp=!!c?a[i].obj[env.id]:a[i];if(!!o[comp]){r.push(a[i])}}return r};fn.difference=function(a,b,c){var r=[],o={},i,comp;for(i=0;i<b.length;i+=1){if(!!c){o[b[i].obj[env.id]]=true}else{o[b[i]]=true}}for(i=0;i<a.length;i+=1){comp=!!c?a[i].obj[env.id]:a[i];if(!o[comp]){r.push(a[i])}}return r};fn.unique=function(a){var o={},i,l=a.length,r=[];for(i=0;i<l;i+=1){o[a[i]]=a[i]}for(i in o){if(o.hasOwnProperty(i)){r.push(o[i])}}return r};fn.uniqueObject=function(a){var o={},i,l=a.length,r=[];for(i=0;i<l;i+=1){o[a[i].obj[env.id]]=a[i]}for(i in o){if(o.hasOwnProperty(i)){r.push(o[i])}}return r};fn.countBy=function(a,o,b){var c=arguments[0],i,j,l=a.length,element={},propsLen;if(!b){b=o;o={};c=o}propsLen=b.length;for(i=0;i<l;i+=1){element=a[i].obj;for(j=0;j<propsLen;j+=1){if(!o[b[j]]){o[b[j]]=1}else{o[b[j]]+=1}}}return c};fn.sumBy=function(a,o,b){var c=arguments[0],i,j,l=a.length,element={},propsLen;if(!b){b=o;o={};c=o}propsLen=b.length;for(i=0;i<l;i+=1){element=a[i].obj;for(j=0;j<propsLen;j+=1){if(!o[b[j]]){o[b[j]]=element[b[j]]}else{o[b[j]]+=element[b[j]]}}}return c};function dedup(){var a=fn.uniqueObject(arguments[0]);return a}fn.groupBy=function(a,o,b){var c=arguments[0],i,j,array=dedup(a),l=array.length,element={},propsLen,group;if(!b){b=o;o={};c=o}propsLen=b.length;for(i=0;i<l;i+=1){element=array[i].obj;group=o;for(j=0;j<propsLen;j+=1){if(j===propsLen-1){if(!group[element[b[j]]]){group[element[b[j]]]=[element]}else{push.call(group[element[b[j]]],element)}}else{if(!group[element[b[j]]]){group[element[b[j]]]={}}}group=group[element[b[j]]]}}return c};fn.groupCount=function(a,o,b){var c=arguments[0],i,j,array=dedup(a),l=array.length,element={},propsLen,group;if(!b){b=o;o={};c=o}propsLen=b.length;for(i=0;i<l;i+=1){element=array[i].obj;group=o;for(j=0;j<propsLen;j+=1){if(j===propsLen-1){if(!group[element[b[j]]]){group[element[b[j]]]=[element]}else{push.call(group[element[b[j]]],element)}}else{if(!group[element[b[j]]]){group[element[b[j]]]={}}}group=group[element[b[j]]];if(!group.count){group.count=1}else{group.count+=1}}}return c};fn.clone=function(o){return JSON.parse(JSON.stringify(o))};fn.include=function(a,i){return indexOf.call(a,i)===-1?false:true};fn.keys=function(o){var k,r=[];for(k in o){if(o.hasOwnProperty(k)){r.push(k)}}return r};fn.values=function(o){return utils.toArray(o)};fn.pick=function(o){var a,props=concat.apply(ArrayProto,arguments),i=props.length,result={};while(i){i-=1;a=props[i];if(o.hasOwnProperty(a)){result[a]=o[a]}}return result};fn.getObjProp=function(a){var i,l=a.length,result=[];for(i=0;i<l;i+=1){push.call(result,a[i].obj)}return result};fn.flatten=function(a,b){var c=[],value,index=-1,length;if(!a){return c}length=a.length;while((index+=1)<length){value=a[index];if(utils.isArray(value)){push.apply(c,b?value:fn.flatten(value))}else{c.push(value)}}return c};fn.map=function(a,b){var i,len=a.length,val,retVal=[];for(i=0;i<len;i+=1){val=a[i];retVal.push(b.call(null,val))}return retVal};fn.where=function(a,b){var i,len=a.length,val,retVal=[];for(i=0;i<len;i+=1){val=a[i];if(b.call(null,val)){retVal.push(val)}}return retVal};fn.each=function(a,b){var i,len=a.length,val,retVal=[];for(i=0;i<len;i+=1){val=a[i];b.call(null,val)}};function pipedValue(){var a=[],args=arguments;if(!!this.pipedObjects[0]&&!!this.pipedObjects[0].obj){a=fn.getObjProp(this.pipedObjects)}else{a=this.pipedObjects}utils.resetPipe.call(this);return a}function fork(){var a={};a=new Helios();a.pipedObjects=this.pipedObjects;utils.resetPipe.call(a);a.pipeline.steps['1']={};a.pipeline.steps['1'].pipedInArgs=this.pipeline.steps[this.pipeline.steps.currentStep].pipedInArgs;a.pipeline.steps['1'].func=this.pipeline.steps[this.pipeline.steps.currentStep].func;a.pipeline.steps['1'].pipedOutArgs=this.pipeline.steps[this.pipeline.steps.currentStep].pipedOutArgs;a.pipeline.steps.currentStep=1;a.preserveSteps=true;utils.resetPipe.call(this);return a}function pin(){var a={};a=new Helios();a.pipedObjects=this.pipedObjects;a.pipelineCache={};a.pipelineCache.pipedOutArgs=this.pipeline.steps[this.pipeline.steps.currentStep].pipedOutArgs;a.pipelineCache.func=this.pipeline.steps[this.pipeline.steps.currentStep].func;utils.resetPipe.call(this);utils.resetPipe.call(a);return a}function map(){var b=[],params=[],args=arguments;if(!!args.length){b=fn.map(this.pipedObjects,function(a){params=[a.obj];push.apply(params,args);return fn.pick.apply(this,params)})}utils.resetPipe();return b}function stringify(){var a=[],args=arguments;if(!!this.pipedObjects[0]&&!!this.pipedObjects[0].obj){return JSON.stringify(map.apply(this,args))}a=this.pipedObjects;utils.resetPipe();return JSON.stringify(a)}function path(){var a=[],stepPaths,stepsObj=this.pipeline.steps,o={},edge,edgeStr,i,j,stepRecs,len;for(i=1;i<=stepsObj.currentStep;i+=1){stepRecs=stepsObj[i].pipedOutArgs[0];stepPaths=o['step '+i]=[];for(j=0,len=stepRecs.length;j<len;j+=1){if(stepRecs[j].type==='vertex'){push.call(stepPaths,'v['+stepRecs[j].obj[env.id]+']')}else{edge=stepRecs[j].obj;edgeStr='v['+edge[env.outVid]+'], e['+edge[env.id]+']['+edge[env.outVid]+'-'+edge[env.label]+'->'+edge[env.inVid]+'], v['+edge[env.inVid]+']';push.call(stepPaths,edgeStr)}}}push.call(a,JSON.stringify(o));push.apply(a,this.pipedObjects);utils.resetPipe();return a}function v(){var a=[],args=fn.flatten(slice.call(arguments,1)),length=args.length;while(length){length-=1;push.call(a,graph.vertices[args[length]])}return a}function e(){var a=[],length,args=fn.flatten(slice.call(arguments,1));length=args.length;while(length){length-=1;push.call(a,graph.edges[args[length]])}return a}function id(){var d=[];d=fn.map(this.pipedObjects,function(a,b,c){return a.obj[env.id]});utils.resetPipe();return d}function label(){var d=[];d=fn.map(this.pipedObjects,function(a,b,c){return a.obj[env.label]});utils.resetPipe();return d}function out(){var e=[],args=slice.call(arguments,1),hasArgs=!!args.length,value;fn.each(arguments[0],function(b,c,d){if(!utils.isEmpty(b.outE)){value=hasArgs?fn.pick(b.outE,args):b.outE;fn.each(fn.flatten(fn.values(value)),function(a){push.call(e,a.inV)})}});return e}function outV(){var d=fn.map(arguments[0],function(a,b,c){return a.outV});return d}function _in(){var e=[],args=slice.call(arguments,1),hasArgs=!!args.length,value;fn.each(arguments[0],function(b,c,d){if(!utils.isEmpty(b.inE)){value=hasArgs?fn.pick(b.inE,args):b.inE;fn.each(fn.flatten(fn.values(value)),function(a){push.call(e,a.outV)})}});return e}function inV(){var d=fn.map(arguments[0],function(a,b,c){return a.inV});return d}function both(){var e=[],args=slice.call(arguments,1),hasArgs=!!args.length,value;fn.each(arguments[0],function(b,c,d){if(!utils.isEmpty(b.outE)){value=hasArgs?fn.pick(b.outE,args):b.outE;fn.each(fn.flatten(fn.values(value)),function(a){push.call(e,a.inV)})}if(!utils.isEmpty(b.inE)){value=hasArgs?fn.pick(b.inE,args):b.inE;fn.each(fn.flatten(fn.values(value)),function(a){push.call(e,a.outV)})}});return e}function bothV(){var d=[];fn.each(arguments[0],function(a,b,c){push.call(d,a.inV);push.call(d,a.outV)});return d}function outE(){var e=[],args=slice.call(arguments,1),hasArgs=!!args.length,value;fn.each(arguments[0],function(b,c,d){if(!utils.isEmpty(b.outE)){value=hasArgs?fn.pick(b.outE,args):b.outE;fn.each(fn.flatten(fn.values(value)),function(a){push.call(e,a)})}});return e}function inE(){var e=[],args=slice.call(arguments,1),hasArgs=!!args.length,value;fn.each(arguments[0],function(b,c,d){if(!utils.isEmpty(b.inE)){value=hasArgs?fn.pick(b.inE,args):b.inE;fn.each(fn.flatten(fn.values(value)),function(a){push.call(e,a)})}});return e}function bothE(){var e=[],args=slice.call(arguments,1),hasArgs=!!args.length,value;fn.each(arguments[0],function(b,c,d){if(!utils.isEmpty(b.outE)){value=hasArgs?fn.pick(b.outE,args):b.outE;fn.each(fn.flatten(fn.values(value)),function(a){push.call(e,a)})}if(!utils.isEmpty(b.inE)){value=hasArgs?fn.pick(b.inE,args):b.inE;fn.each(fn.flatten(fn.values(value)),function(a){push.call(e,a)})}});return e}function V(){var a=slice.call(arguments,1);if(a.length===2){return utils.toArray(graph.v_idx[a[0]][a[1]])}return utils.toArray(graph.vertices)}function E(){var a=slice.call(arguments,1);if(a.length===2){return utils.toArray(graph.e_idx[a[0]][a[1]])}return utils.toArray(graph.edges)}function tail(){var c=[],tempArr=[],tempPipe=[],args=slice.call(arguments,1),hasArgs=!!args.length,value,self=this;fn.each(arguments[0],function(b){if(!self.traversedVertices[b.obj[env.id]]){self.traversedVertices[b.obj[env.id]]='visited';value=hasArgs?fn.pick(b.outE,args):b.outE;if(utils.isEmpty(value)){if(hasArgs){if(!utils.isEmpty(fn.pick(b.inE,args))){push.call(c,b)}}else{push.call(c,b)}}else{tempArr=[];tempPipe=[];fn.each(fn.flatten(fn.values(value)),function(a){if(!self.traversedEdges[a.obj[env.id]]){push.call(tempArr,a.inV);self.traversedEdges[a.obj[env.id]]='visited'}});push.call(tempPipe,tempArr);push.apply(tempPipe,args);push.apply(c,tail.apply(self,tempPipe))}}});return c}function head(){var c=[],tempArr=[],tempPipe=[],args=slice.call(arguments,1),hasArgs=!!args.length,value,self=this;fn.each(arguments[0],function(b){if(!self.traversedVertices[b.obj[env.id]]){self.traversedVertices[b.obj[env.id]]='visited';value=hasArgs?fn.pick(b.inE,args):b.inE;if(utils.isEmpty(value)){if(hasArgs){if(!utils.isEmpty(fn.pick(b.outE,args))){push.call(c,b)}}else{push.call(c,b)}}else{tempArr=[];tempPipe=[];fn.each(fn.flatten(fn.values(value)),function(a){if(!self.traversedEdges[a.obj[env.id]]){push.call(tempArr,a.outV);self.traversedEdges[a.obj[env.id]]='visited'}});push.call(tempPipe,tempArr);push.apply(tempPipe,args);push.apply(c,head.apply(self,tempPipe))}}});return c}function store(){var a=arguments[0],args=slice.call(arguments,1),func,funcArgs=[];if(!!args.length){if(utils.isArray(args[0])){push.apply(args[0],arguments[0])}else{this.pipeline.namedStep[args[0]]=this.pipeline.steps.currentStep}if(utils.isFunction(args[1])){func=args[1];args.shift();funcArgs=fn.flatten(slice.call(args,1));a=func.apply(arguments[0],funcArgs)}}return a}function back(){var a=arguments[1],stepBackTo;if(utils.isArray(a)){return a}if(utils.isString(a)){if(utils.isUndefined(this.pipeline.namedStep[a])){return}stepBackTo=this.pipeline.namedStep[a]}else{stepBackTo=this.pipeline.steps.currentStep-a}return this.pipeline.steps[stepBackTo].pipedOutArgs[0]}function except(){var a=arguments[1],dSet,diff,retVal=[];dSet=utils.isArray(a)?a:this.pipeline.steps[this.pipeline.namedStep[a]].pipedOutArgs[0];retVal=fn.difference(arguments[0],dSet,true);return retVal}function where(){var b=[],records=arguments[0],args=slice.call(arguments,1),func,funcArgs=[],argLen=args.length;if(utils.isFunction(args[0])){func=args[0];funcArgs=fn.flatten(slice.call(args,1),true);fn.each(records,function(a){if(func.apply(a.obj,funcArgs)){push.call(b,a)}})}else{while(argLen){argLen-=2;b=fn.where(records,comparable[args[argLen]](args[argLen+1]))}}this.pipeline.namedStep.where=this.pipeline.steps.currentStep;return b}function or(){var b=[],prevRecords=arguments[0],args=slice.call(arguments,1),records=this.pipeline.steps[this.pipeline.namedStep.where].pipedInArgs[0],func,funcArgs=[],argLen,i,len,ids=[];if(utils.isFunction(args[0])){func=args[0];funcArgs=fn.flatten(slice.call(args,1),true);fn.each(records,function(a){if(func.apply(a.obj,funcArgs)){push.call(b,a)}})}else{argLen=args.length;while(argLen){argLen-=2;b=fn.where(records,comparable[args[argLen]](args[argLen+1]))}}len=b.length;for(i=0;i<len;i+=1){push.call(ids,b[i].obj[env.id])}ids=fn.unique(ids);len=prevRecords.length;for(i=0;i<len;i+=1){if(!fn.include(ids,prevRecords[i].obj[env.id])){push.call(b,prevRecords[i])}}return b}function retain(){var a=arguments[1],dSet,diff,retVal=[];dSet=utils.isArray(a)?a:this.pipeline.steps[this.pipeline.namedStep[a]].pipedOutArgs[0];retVal=fn.intersection(arguments[0],dSet,true);return retVal}function step(){var a=[],tempArr=[],args=slice.call(arguments,1),func,funcArgs=[];if(utils.isFunction(args[0])){func=args[0];funcArgs=fn.flatten(slice.call(args,1),true);a=func.apply(arguments[0],funcArgs)}else{a="Invalid function"}return a}function count(){var a=this.pipedObjects.length;utils.resetPipe.call(this);return a}function countBy(){var a=fn.flatten(slice.call(arguments,1)),objVar=a[0],params;if(utils.isString(a[0])){objVar=slice.call(a)}else{params=slice.call(a,1)}return fn.countBy(arguments[0],objVar,params)}function groupSum(){var a=fn.flatten(slice.call(arguments,1)),objVar=a[0],params;if(utils.isString(a[0])){objVar=slice.call(a)}else{params=slice.call(a,1)}return fn.sumBy(arguments[0],objVar,params)}function groupBy(){var a=fn.flatten(slice.call(arguments,1)),objVar=a[0],params;if(utils.isString(a[0])){objVar=slice.call(a)}else{params=slice.call(a,1)}return fn.groupBy(arguments[0],objVar,params)}function groupCount(){var a=fn.flatten(slice.call(arguments,1)),objVar=a[0],params;if(utils.isString(a[0])){objVar=slice.call(a)}else{params=slice.call(a,1)}return fn.groupCount(arguments[0],objVar,params)}function loop(){var a=arguments[1],iterations=arguments[2]-1,j,func,funcName,fromStep,toStep,self=this;if(utils.isString(a)){a=self.pipeline.steps.currentStep+1-self.pipeline.namedStep[a]}while(iterations--){fromStep=self.pipeline.steps.currentStep+1-a;toStep=self.pipeline.steps.currentStep;for(j=fromStep;j<=toStep;j+=1){func=self.pipeline.steps[j].func;funcName=func.name==='_in'?'in':func.name;this[funcName].apply(self,slice.call(self.pipeline.steps[j].pipedInArgs,1))}}return self.pipeline.steps[self.pipeline.steps.currentStep].pipedOutArgs[0]}function clone(){return JSON.parse(stringify())}comparable.eq=function(b){return function(x){var a=b.length;while(a){a-=2;if(x.obj[b[a]]===b[a+1]){return true}}return false}};comparable.neq=function(b){return function(x){var a=b.length;while(a){a-=2;if(x.obj[b[a]]!==b[a+1]){return true}}return false}};comparable.lt=function(b){return function(x){var a=b.length;while(a){a-=2;if(x.obj[b[a]]<b[a+1]){return true}}return false}};comparable.lte=function(b){return function(x){var a=b.length;while(a){a-=2;if(x.obj[b[a]]<=b[a+1]){return true}}return false}};comparable.gt=function(b){return function(x){var a=b.length;while(a){a-=2;if(x.obj[b[a]]>b[a+1]){return true}}return false}};comparable.gte=function(b){return function(x){var a=b.length;while(a){a-=2;if(x.obj[b[a]]>=b[a+1]){return true}}return false}};comparable.btwn=function(b){return function(x){var a=b.length;while(a){a-=3;if(x.obj[b[a]]>b[a+1]&&x.obj[b[a]]<b[a+2]){return true}}return false}};comparable.has=function(b){return function(x){var a=slice.call(b,1);return fn.intersection(fn[b[0]](x.obj),a).length===a.length}};comparable.hasNot=function(b){return function(x){var a=slice.call(b,1);return fn.intersection(fn[b[0]](x.obj),a).length!==a.length}};comparable.hasAny=function(a){return function(x){return!!fn.intersection(fn[a[0]](x.obj),slice.call(a,1)).length}};comparable.hasNotAny=function(a){return function(x){return!fn.intersection(fn[a[0]](x.obj),slice.call(a,1)).length}};Helios.prototype.step=step;Helios.prototype.transform=step;Helios.prototype.map=map;Helios.prototype.id=id;Helios.prototype.label=label;Helios.prototype.V=V;Helios.prototype.E=E;Helios.prototype.out=out;Helios.prototype['in']=_in;Helios.prototype.outV=outV;Helios.prototype.outE=outE;Helios.prototype.inV=inV;Helios.prototype.inE=inE;Helios.prototype.both=both;Helios.prototype.bothV=bothV;Helios.prototype.bothE=bothE;Helios.prototype.head=head;Helios.prototype.tail=tail;Helios.prototype.path=path;Helios.prototype.stringify=stringify;Helios.prototype.value=pipedValue;Helios.prototype.fork=fork;Helios.prototype.pin=pin;Helios.prototype.where=where;Helios.prototype.and=where;Helios.prototype.or=or;Helios.prototype.back=back;Helios.prototype.except=except;Helios.prototype.retain=retain;Helios.prototype.dedup=dedup;Helios.prototype.sideEffect=step;Helios.prototype.as=store;Helios.prototype.store=store;Helios.prototype.countBy=countBy;Helios.prototype.groupBy=groupBy;Helios.prototype.groupCount=groupCount;Helios.prototype.groupSum=groupSum;Helios.prototype.count=count;Helios.prototype.loop=loop;Helios.prototype.v=v;Helios.prototype.e=e;Helios.prototype.graph=graphUtils;Helios.prototype.clone=clone;if(typeof define=='function'&&typeof define.amd=='object'&&define.amd){f.Helios=Helios;define(function(){return Helios})}else if(h){if(typeof module=='object'&&module&&module.exports==h){(module.exports=Helios).Helios=Helios}else{h.Helios=Helios}}else{f.Helios=Helios}}(this));